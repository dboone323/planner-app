name: Workflow Failure Notify

on:
  workflow_run:
    types: [completed]

jobs:
  notify-failure:
    if: ${{ github.event.workflow_run.conclusion != 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: Notify repository dispatch
        uses: peter-evans/repository-dispatch@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          event-type: workflow_failure
          client-payload: |
            {
              "workflow": "${{ github.event.workflow_run.name }}",
              "conclusion": "${{ github.event.workflow_run.conclusion }}",
              "url": "${{ github.event.workflow_run.html_url }}",
              "head_branch": "${{ github.event.workflow_run.head_branch }}"
            }
