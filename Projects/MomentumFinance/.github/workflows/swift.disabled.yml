---
name: Swift CI
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  build:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Swift
        uses: swift-actions/setup-swift@v2
        with:
          swift-version: '6.0'
      - name: Install SwiftLint
        run: brew install swiftlint || echo "Failed to install SwiftLint, continuing..."
      - name: Install SwiftFormat
        run: brew install swiftformat || echo "Failed to install SwiftFormat, continuing..."
      - name: Format Swift code (unified config)
        run: swiftformat . --config Tools/Config/UNIFIED_SWIFTFORMAT_ROOT || echo "SwiftFormat failed, continuing..."
      - name: Lint Swift code (unified config)
        run: swiftlint lint --config Tools/Config/UNIFIED_SWIFTLINT_ROOT.yml --reporter github-actions-logging || echo "SwiftLint found issues but continuing..."
      - name: SwiftPM build
        run: swift build -v || echo "SwiftPM build failed, trying Xcode..."
      - name: Xcode build (best-effort)
        run: |
          if [ -f "MomentumFinance.xcodeproj/project.pbxproj" ]; then
            xcodebuild -project MomentumFinance.xcodeproj -scheme MomentumFinance -sdk iphonesimulator -destination 'platform=iOS Simulator,name=iPhone 16' build || echo "Xcode build failed"
          else
            echo "No Xcode project found"
          fi
      - name: SwiftPM tests (non-fatal)
        run: swift test -v || echo "SwiftPM tests failed or none present"
